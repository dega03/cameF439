/*
 * Came.c
 *
 *  Created on: 30 Jun 2020
 *      Author: Marco
 */

#include "Came.h"

struct CodeLog Codes[NCodesInMem];
extern uint32_t NewCodePtr;
extern uint32_t NewCode2ReadPtr;

extern uint32_t SWIMStatus;
extern unsigned int Data[128];
extern char TxBuffer[1024];

CAMESTATUS CameStatus;
uint8_t  AddrCode;   //Address for code, 0..50
uint8_t  CodeData[16];   //[AA or 00] [1/2/3 or FF] [code1] .. [code8]

void CheckStoreCode(void) {

	uint32_t CodeTmp;

	LL_GPIO_SetOutputPin(LD1_GPIO_Port, LD1_Pin);
	SWIM_Read(0x50,0x30,(uint16_t *)&Data);
	HAL_Delay(1);
	if ((SWIMStatus == SWIM_Idle) && ((Data[14] & 0xffff) == 0xAA)) {  //9 bytes from 0x6C, if = AA then there is a new code
		//Store time and code
		Codes[NewCodePtr].Timestamp = LL_TIM_GetCounter(TIM2);

		CodeTmp = (Data[14] & 0xf0000) >>16;
		if ((Data[15] & 0xf) != 0) {
			//There are at least 2 codes
			CodeTmp = (CodeTmp << 4) | (Data[15] & 0xf);
			if (((Data[15]>>16) & 0xf) != 0) {
				//There are at least 3 codes
				CodeTmp = (CodeTmp << 4) | ((Data[15]>>16) & 0xf);
				if ((Data[16] & 0xf) != 0) {
					//There are at least 4 codes
					CodeTmp = (CodeTmp << 4) | (Data[16] & 0xf);
					if (((Data[16]>>16) & 0xf) != 0) {
						//There are at least 5 codes
						CodeTmp = (CodeTmp << 4) | ((Data[16]>>16) & 0xf);
						if ((Data[17] & 0xf) != 0) {
							//There are at least 6 codes
							CodeTmp = (CodeTmp << 4) | (Data[17] & 0xf);
							if (((Data[17]>>16) & 0xf) != 0) {
								//There are at least 7 codes
								CodeTmp = (CodeTmp << 4) | ((Data[17]>>16) & 0xf);
								if ((Data[18] & 0xf) != 0) {
									//There are 8 codes
									CodeTmp = (CodeTmp << 4) | (Data[18] & 0xf) ;
								}
							}
						}
					}
				}
			}
		}
		Codes[NewCodePtr].Code = CodeTmp; //(Data[14] & 0xf)>>16 | (Data[15] & 0xf) << 4 | (Data[15] & 0xf0000)>>8 | (Data[15] & 0xf)<<16 | (Data[15] & 0xf0000)>>16 | (Data[15] & 0xf) | (Data[15] & 0xf0000)>>16 | (Data[15] & 0xf);
		Codes[NewCodePtr].Status = (Data[4] & 0xffff0000) | (Data[5] & 0xffff); //AAxxxx if opened, 01/02 if opened relais 1 or 2, ff if wrong code
		if (Codes[NewCodePtr].Code != 0)  //Sometimes it stores empty data, with this it will not happen
			NewCodePtr++;

		if (NewCodePtr >= NCodesInMem)
			NewCodePtr = 0;

		//Reset code in Ram, so I won't read it again
		memset(Data, 0,18);
		SWIM_Write(0x6c, 9,(uint16_t *)&Data);
	}
	LL_GPIO_ResetOutputPin(LD1_GPIO_Port, LD1_Pin);

}

void ReadFlashCode(void) {

	uint32_t i;
	uint16_t * DataPtr;

	DataPtr = (uint16_t *)&Data;
	LL_GPIO_SetOutputPin(LD1_GPIO_Port, LD1_Pin);

	SWIM_Read(0x4000 + ((uint32_t)AddrCode * 10), 0x10,DataPtr);
	if (SWIMStatus == SWIM_Idle) {
		for (i=0;i<10;i++)
			CodeData[i] = *DataPtr++;
		CameStatus = CameOpIdle;
	}
	LL_GPIO_ResetOutputPin(LD1_GPIO_Port, LD1_Pin);
}

void WriteFlashCode(void) {

	uint8_t IAPSR;
	uint32_t i;
	uint16_t * DataPtr;

	LL_GPIO_SetOutputPin(LD1_GPIO_Port, LD1_Pin);

	Data[0] = 0xAE;
	Data[1] = 0x56;
	//Enable flash operation in MASS
	SWIM_Write(0x5064, 1,(uint16_t *)&Data[0]);
	SWIM_Write(0x5064, 1,(uint16_t *)&Data[1]);
	SWIM_Read (0x505F, 1,(uint16_t *)&Data);
	IAPSR = Data[0] & 0xff;
	if ((IAPSR & 0x8) == 0x8) {  //Flash op is enabled
		//Now do my business
		if (CodeData[0] == 0) {  //I am deleting a code, so write just first byte
			Data[0] = CodeData[0];
			SWIM_Write(0x4000 + ((uint32_t)AddrCode * 10), 1,(uint16_t *)&Data);  //Write Data [0]
			IAPSR = IAPSR & 0xFB; //Clear bit EOP (bit 2)
			i = 0;
			while (((IAPSR & 0x4) != 4) && (i<30)) {
				HAL_Delay(1);
				SWIM_Read (0x505F, 1,(uint16_t *)&Data);
				IAPSR = Data[0] & 0xff;
				i++;
			}
		} else {
			Data[0] = 0xbf0040;  //Enable word programming
			SWIM_Write(0x505B, 2,(uint16_t *)&Data);  //Enable standard block programming

			DataPtr = (uint16_t *)&Data;
			*DataPtr++ = CodeData[0];
			*DataPtr++ = CodeData[1];
			*DataPtr++ = CodeData[2];
			*DataPtr++ = CodeData[3];

			SWIM_Write(0x4000 + ((uint32_t)AddrCode * 10), 4,(uint16_t *)&Data);
			IAPSR = IAPSR & 0xFB; //Clear bit EOP (bit 2)
			i = 0;
			while (((IAPSR & 0x4) != 4) && (i<30)) {
				HAL_Delay(1);
				SWIM_Read (0x505F, 1,(uint16_t *)&Data);
				IAPSR = Data[0] & 0xff;
				i++;
			}

			Data[0] = 0xbf0040;  //Enable word programming
			SWIM_Write(0x505B, 2,(uint16_t *)&Data);  //Enable standard block programming

			DataPtr = (uint16_t *)&Data;
			*DataPtr++ = CodeData[4];
			*DataPtr++ = CodeData[5];
			*DataPtr++ = CodeData[6];
			*DataPtr++ = CodeData[7];

			SWIM_Write(0x4004 + ((uint32_t)AddrCode * 10), 4,(uint16_t *)&Data);  //Write Data [4:7]
			IAPSR = IAPSR & 0xFB; //Clear bit EOP (bit 2)
			i = 0;
			while (((IAPSR & 0x4) != 4) && (i<30)) {
				HAL_Delay(1);
				SWIM_Read (0x505F, 1,(uint16_t *)&Data);
				IAPSR = Data[0] & 0xff;
				i++;
			}

			Data[0] = CodeData[8];
			SWIM_Write(0x4008 + ((uint32_t)AddrCode * 10), 1,(uint16_t *)&Data);  //Write Data [8]
			IAPSR = IAPSR & 0xFB; //Clear bit EOP (bit 2)
			i = 0;
			while (((IAPSR & 0x4) != 4) && (i<30)) {
				HAL_Delay(1);
				SWIM_Read (0x505F, 1,(uint16_t *)&Data);
				IAPSR = Data[0] & 0xff;
				i++;
			}

			Data[0] = CodeData[9];
			SWIM_Write(0x4009 + ((uint32_t)AddrCode * 10), 1,(uint16_t *)&Data);  //Write Data [9]
			IAPSR = IAPSR & 0xFB; //Clear bit EOP (bit 2)
			i = 0;
			while (((IAPSR & 0x4) != 4) && (i<30)) {
				HAL_Delay(1);
				SWIM_Read (0x505F, 1,(uint16_t *)&Data);
				IAPSR = Data[0] & 0xff;
				i++;
			}
		}
		if (SWIMStatus == SWIM_Idle) {
			//Disable flash operation in MASS
			IAPSR = IAPSR & 0xF7;  //Clear bit 5 (DUL)
			Data[0] = IAPSR;
			SWIM_Write(0x505F, 1,(uint16_t *)&Data);
			CameStatus = CameOpIdle;
		}
	}

	LL_GPIO_ResetOutputPin(LD1_GPIO_Port, LD1_Pin);

}


/**
  ******************************************************************************
  *** A if AA => code accettato, Rl = relais 1 o 2, D0..D7 = last good code, Nb = numero pulsanti premuti
  ***   Cd = countdown,  To = timeout for too many codes, NW = nr of wrong codes (at 5 goes in timeout)
  ***   LK = last key, d0..d7 = last code inserted, b0..b7 = current code being typed, if more than 8 keys, it shifts left to use last 8
  ***
  ******************************** A  Rl D0 D1 D2 D3 D4 D5 D6 D7 ?? Nb ?? ?? ?? Cd To NW ?? LK d0 d1 d2 d3 d4 d5 d6 d7 b0 b1 b2 b3 b4 b5 b6 b7
offset   0     1     2     3     4     5     6     7    8      9    10    11    12    13    14    15    16    17    18    19    20    21    22    23  |  [These bytes are not read
  *0x   50          54          58          5C          60          64          68          6C          70          74          78          7C         |80          84          88          8C
00050 > 00 00 00 00.00 00 00 00|00 00 FF FF.FF FF FF FF|FF FF FF 05.00 03 00 00|07 00 01 07.00 00 00 00|00 00 00 00.00 00 00 00|00 00 00 00.00 00 02 FB|00 00 00 00.01 D0 01 D0|00 00 00 00.00 00 00 00|
00050 > 00 00 00 00.00 00 00 00|00 00 FF FF.FF FF FF FF|FF FF FF 05.00 03 00 00|07 00 01 07.00 00 00 00|00 00 00 00.00 00 00 00|00 00 00 00.00 00 02 FB|00 00 00 00.01 D0 01 D0|00 00 00 00.00 00 00 00|
00050 > 00 00 00 00.00 00 00 00|00 00 FF FF.FF FF FF FF|FF FF FF 05.00 03 00 00|06 00 01 07.00 00 00 00|00 00 00 00.00 00 00 00|00 00 00 00.00 00 02 FB|00 00 00 00.01 D0 01 D0|00 00 00 00.00 00 00 00|
00050 > 00 00 00 00.00 00 00 00|00 00 FF FF.FF FF FF FF|FF FF FF 01.01 00 00 00|0A 00 01 07.03 00 00 00|00 00 00 00.00 03 00 00|00 00 00 00.00 00 01 64|00 00 00 00.09 C0 09 C0|00 00 00 00.00 00 00 00|  Start to type 3 3 3 3 3 3 code
00050 > 00 00 00 00.00 00 00 00|00 00 FF FF.FF FF FF FF|FF FF FF 01.01 00 00 00|0A 00 01 07.03 00 00 00|00 00 00 00.00 03 00 00|00 00 00 00.00 00 01 64|00 00 00 00.09 C0 09 C0|00 00 00 00.00 00 00 00|
00050 > 00 00 00 00.00 00 00 00|00 00 FF FF.FF FF FF FF|FF FF FF 05.02 01 00 00|0A 00 01 07.03 00 00 00|00 00 00 00.00 03 03 00|00 00 00 00.00 00 02 12|00 00 00 00.01 C0 01 C0|00 00 00 00.00 00 00 00|
00050 > 00 00 00 00.00 00 00 00|00 00 FF FF.FF FF FF FF|FF FF FF 01.03 1A 0C 00|0A 00 01 07.03 00 00 00|00 00 00 00.00 03 03 03|00 00 00 00.00 00 03 D5|00 00 09 C0.09 C0 09 C0|00 00 00 00.00 00 00 00|
00050 > 00 00 00 00.00 00 00 00|00 00 FF FF.FF FF FF FF|FF FF FF 05.03 01 00 00|0A 00 01 07.03 00 00 00|00 00 00 00.00 03 03 03|00 00 00 00.00 00 02 CF|00 00 00 00.09 C0 09 C0|00 00 00 00.00 00 00 00|
00050 > 00 00 00 00.00 00 00 00|00 00 FF FF.FF FF FF FF|FF FF FF 05.04 01 00 00|0A 00 01 07.03 00 00 00|00 00 00 00.00 03 03 03|03 00 00 00.00 00 02 E5|00 00 00 00.01 C0 01 C0|00 00 00 00.00 00 00 00|
00050 > 00 00 00 00.00 00 00 00|00 00 FF FF.FF FF FF FF|FF FF FF 05.04 06 02 05|0A 00 01 07.03 00 00 00|00 00 00 00.00 03 03 03|03 00 00 00.00 00 02 5D|00 00 00 02.01 C0 01 C0|00 00 00 00.00 00 00 00|
00050 > 00 00 00 00.00 00 00 00|00 00 FF FF.FF FF FF FF|FF FF FF 01.05 1A 0C 00|0A 00 01 07.03 00 00 00|00 00 00 00.00 03 03 03|03 03 00 00.00 00 03 D7|00 00 09 C0.09 C0 09 C0|00 00 00 00.00 00 00 00|
00050 > 00 00 00 00.00 00 00 00|00 00 FF FF.FF FF FF FF|FF FF FF 05.06 01 00 00|0A 00 01 07.03 00 00 00|00 00 00 00.00 03 03 03|03 03 03 00.00 00 02 14|00 00 00 00.01 C0 01 C0|00 00 00 00.00 00 00 00|
00050 > 00 00 00 00.00 00 00 00|00 00 FF FF.FF FF FF FF|FF FF FF 05.06 01 00 00|0A 00 01 07.03 00 00 00|00 00 00 00.00 03 03 03|03 03 03 00.00 00 02 14|00 00 00 00.01 C0 01 C0|00 00 00 00.00 00 00 00|
00050 > 00 00 00 00.00 00 00 00|00 AA 01 03.03 03 03 03|03 00 00 01.00 1A 0C 00|0A 00 00 07.AA 03 03 03|03 03 03 00.00 00 00 00|00 00 00 00.00 00 03 E6|00 00 09 D0.09 D0 09 D0|00 00 00 00.00 00 00 00| Press #, code accepted
00050 > 00 00 00 00.00 00 00 00|00 AA 01 03.03 03 03 03|03 00 00 01.00 1A 0C 00|0A 00 00 07.00 00 00 00|00 00 00 00.00 00 00 00|00 00 00 00.00 00 03 E6|00 00 09 D0.09 D0 09 D0|00 00 00 00.00 00 00 00| Code read and erased
00050 > 00 00 00 00.00 00 00 00|00 AA 01 03.03 03 03 03|03 00 00 05.00 07 02 00|09 00 00 07.00 00 00 00|00 00 00 00.00 00 00 00|00 00 00 00.00 00 03 A4|00 00 00 03.09 D0 09 D0|00 00 00 00.00 00 00 00|
00050 > 00 00 00 00.00 00 00 00|00 AA 01 03.03 03 03 03|03 00 00 05.00 07 02 00|09 00 00 07.00 00 00 00|00 00 00 00.00 00 00 00|00 00 00 00.00 00 03 A4|00 00 00 03.09 D0 09 D0|00 00 00 00.00 00 00 00|
00050 > 00 00 00 00.00 00 00 00|00 AA 01 03.03 03 03 03|03 00 00 01.01 00 00 00|0A 00 00 07.02 00 00 00|00 00 00 00.00 02 00 00|00 00 00 00.00 00 01 B8|00 00 00 00.09 C1 09 C1|00 00 00 00.00 00 00 00| Code 2 2 2 2 2 2
00050 > 00 00 00 00.00 00 00 00|00 AA 01 03.03 03 03 03|03 00 00 01.02 1A 0C 00|0A 00 00 07.02 00 00 00|00 00 00 00.00 02 02 00|00 00 00 00.00 00 03 FF|00 00 01 C1.01 C1 01 C1|00 00 00 00.00 00 00 00|
00050 > 00 00 00 00.00 00 00 00|00 AA 01 03.03 03 03 03|03 00 00 05.02 01 00 00|0A 00 00 07.02 00 00 00|00 00 00 00.00 02 02 00|00 00 00 00.00 00 01 FA|00 00 00 00.01 C1 01 C1|00 00 00 00.00 00 00 00|
00050 > 00 00 00 00.00 00 00 00|00 AA 01 03.03 03 03 03|03 00 00 01.03 1A 0C 00|0A 00 00 07.02 00 00 00|00 00 00 00.00 02 02 02|00 00 00 00.00 00 03 FF|00 00 09 C1.09 C1 09 C1|00 00 00 00.00 00 00 00|
00050 > 00 00 00 00.00 00 00 00|00 AA 01 03.03 03 03 03|03 00 00 01.03 00 00 00|0A 00 00 07.02 00 00 00|00 00 00 00.00 02 02 02|00 00 00 00.00 00 03 4A|00 00 00 00.09 C1 09 C1|00 00 00 00.00 00 00 00|
00050 > 00 00 00 00.00 00 00 00|00 AA 01 03.03 03 03 03|03 00 00 01.04 1A 0C 00|0A 00 00 07.02 00 00 00|00 00 00 00.00 02 02 02|02 00 00 00.00 00 04 03|00 00 01 C1.01 C1 01 C1|00 00 00 00.00 00 00 00|
00050 > 00 00 00 00.00 00 00 00|00 AA 01 03.03 03 03 03|03 00 00 01.05 1A 0C 00|0A 00 00 07.02 00 00 00|00 00 00 00.00 02 02 02|02 02 00 00.00 00 04 03|00 00 09 C1.09 C1 09 C1|00 00 00 00.00 00 00 00|
00050 > 00 00 00 00.00 00 00 00|00 AA 01 03.03 03 03 03|03 00 00 01.05 1A 0C 00|0A 00 00 07.02 00 00 00|00 00 00 00.00 02 02 02|02 02 00 00.00 00 04 03|00 00 09 C1.09 C1 09 C1|00 00 00 00.00 00 00 00|
00050 > 00 00 00 00.00 00 00 00|00 AA 01 03.03 03 03 03|03 00 00 01.06 1A 0C 00|0A 00 00 07.02 00 00 00|00 00 00 00.00 02 02 02|02 02 02 00.00 00 04 05|00 00 01 C1.01 C1 01 C1|00 00 00 00.00 00 00 00|
00050 > 00 00 00 00.00 00 00 00|00 AA 01 03.03 03 03 03|03 00 00 01.06 1A 0C 00|0A 00 00 07.02 00 00 00|00 00 00 00.00 02 02 02|02 02 02 00.00 00 04 05|00 00 01 C1.01 C1 01 C1|00 00 00 00.00 00 00 00|
00050 > 00 00 00 00.00 00 00 00|00 AA 02 02.02 02 02 02|02 00 00 01.00 00 00 00|0A 00 00 07.AA 02 02 02|02 02 02 00.00 00 00 00|00 00 00 00.00 00 01 8B|00 00 00 00.09 D0 09 D0|00 00 00 00.00 00 00 00| Code accepted
00050 > 00 00 00 00.00 00 00 00|00 AA 02 02.02 02 02 02|02 00 00 01.00 00 00 00|0A 00 00 07.00 00 00 00|00 00 00 00.00 00 00 00|00 00 00 00.00 00 01 8B|00 00 00 00.09 D0 09 D0|00 00 00 00.00 00 00 00|
00050 > 00 00 00 00.00 00 00 00|00 AA 02 02.02 02 02 02|02 00 00 01.00 00 00 00|09 00 00 07.00 00 00 00|00 00 00 00.00 00 00 00|00 00 00 00.00 00 01 8B|00 00 00 00.09 D0 09 D0|00 00 00 00.00 00 00 00|
00050 > 00 00 00 00.00 00 00 00|00 AA 02 02.02 02 02 02|02 00 00 01.00 00 00 00|09 00 00 07.00 00 00 00|00 00 00 00.00 00 00 00|00 00 00 00.00 00 01 8B|00 00 00 00.09 D0 09 D0|00 00 00 00.00 00 00 00|
00050 > 00 00 00 00.00 00 00 00|00 AA 02 02.02 02 02 02|02 00 00 01.01 00 00 00|0A 00 00 07.08 00 00 00|00 00 00 00.00 08 00 00|00 00 00 00.00 00 01 19|00 00 00 00.01 D1 01 D1|00 00 00 00.00 00 00 00| Stat to type 8 8 8 8 8 8 8 8
00050 > 00 00 00 00.00 00 00 00|00 AA 02 02.02 02 02 02|02 00 00 01.01 00 00 00|0A 00 00 07.08 00 00 00|00 00 00 00.00 08 00 00|00 00 00 00.00 00 B6 AD|00 00 00 00.01 D1 01 D1|00 00 00 00.00 00 00 00|
00050 > 00 00 00 00.00 00 00 00|00 AA 02 02.02 02 02 02|02 00 00 01.02 1A 0C 00|0A 00 00 07.08 00 00 00|00 00 00 00.00 08 08 00|00 00 00 00.00 00 02 B9|00 00 09 D1.09 D1 09 D1|00 00 00 00.00 00 00 00|
00050 > 00 00 00 00.00 00 00 00|00 AA 02 02.02 02 02 02|02 00 00 01.02 1A 0C 00|09 00 00 07.08 00 00 00|00 00 00 00.00 08 08 00|00 00 00 00.00 00 02 B9|00 00 09 D1.09 D1 09 D1|00 00 00 00.00 00 00 00|
00050 > 00 00 00 00.00 00 00 00|00 AA 02 02.02 02 02 02|02 00 00 01.03 1A 0C 01|0A 00 00 07.08 00 00 00|00 00 00 00.00 08 08 08|00 00 00 00.00 00 03 C3|00 00 01 D1.01 D1 01 D1|00 00 00 00.00 00 00 00|
00050 > 00 00 00 00.00 00 00 00|00 AA 02 02.02 02 02 02|02 00 00 05.03 01 00 00|0A 00 00 07.08 00 00 00|00 00 00 00.00 08 08 08|00 00 00 00.00 00 02 E5|00 00 00 00.01 D1 01 D1|00 00 00 00.00 00 00 00|
00050 > 00 00 00 00.00 00 00 00|00 AA 02 02.02 02 02 02|02 00 00 05.04 01 00 00|0A 00 00 07.08 00 00 00|00 00 00 00.00 08 08 08|08 00 00 00.00 00 02 E0|00 00 00 00.09 D1 09 D1|00 00 00 00.00 00 00 00|
00050 > 00 00 00 00.00 00 00 00|00 AA 02 02.02 02 02 02|02 00 00 04.04 0C 05 04|09 00 00 07.08 00 00 00|00 00 00 00.00 08 08 08|08 00 00 00.00 00 03 F4|00 00 00 03.09 D1 09 D1|00 00 00 00.00 00 00 00|
00050 > 00 00 00 00.00 00 00 00|00 AA 02 02.02 02 02 02|02 00 00 01.05 00 00 00|0A 00 00 07.08 00 00 00|00 00 00 00.00 08 08 08|08 08 00 00.00 00 01 8F|00 00 00 00.01 D1 01 D1|00 00 00 00.00 00 00 00|
00050 > 00 00 00 00.00 00 00 00|00 AA 02 02.02 02 02 02|02 00 00 01.06 1A 0C 00|0A 00 00 07.08 00 00 00|00 00 00 00.00 08 08 08|08 08 08 00.00 00 04 02|00 00 09 D1.09 D1 09 D1|00 00 00 00.00 00 00 00|
00050 > 00 00 00 00.00 00 00 00|00 AA 02 02.02 02 02 02|02 00 00 05.06 03 00 00|0A 00 00 07.08 00 00 00|00 00 00 00.00 08 08 08|08 08 08 00.00 00 03 67|00 00 00 00.09 D1 09 D1|00 00 00 00.00 00 00 00|
00050 > 00 00 00 00.00 00 00 00|00 AA 02 02.02 02 02 02|02 00 00 01.07 00 00 00|0A 00 00 07.08 00 00 00|00 00 00 00.00 08 08 08|08 08 08 08.00 00 00 59|00 00 00 00.01 D1 01 D1|00 00 00 00.00 00 00 00|
00050 > 00 00 00 00.00 00 00 00|00 AA 02 02.02 02 02 02|02 00 00 01.08 1A 0C 00|0A 00 00 07.08 00 00 00|00 00 00 00.00 08 08 08|08 08 08 08.08 00 03 FA|00 00 09 D1.09 D1 09 D1|00 00 00 00.00 00 00 00|
00050 > 00 00 00 00.00 00 00 00|00 AA 02 02.02 02 02 02|02 00 00 01.08 1A 0C 00|0A 00 00 07.08 00 00 00|00 00 00 00.00 08 08 08|08 08 08 08.08 00 03 FA|00 00 09 D1.09 D1 09 D1|00 00 00 00.00 00 00 00|
00050 > 00 00 00 00.00 00 00 00|00 AA 01 08.08 08 08 08|08 08 08 01.00 1A 0C 00|0A 00 00 07.AA 08 08 08|08 08 08 08.08 00 00 00|00 00 00 00.00 00 03 E3|00 00 01 D0.01 D0 01 D0|00 00 00 00.00 00 00 00| Code accepted
00050 > 00 00 00 00.00 00 00 00|00 AA 01 08.08 08 08 08|08 08 08 01.00 1A 0C 00|0A 00 00 07.00 00 00 00|00 00 00 00.00 00 00 00|00 00 00 00.00 00 03 E3|00 00 01 D0.01 D0 01 D0|00 00 00 00.00 00 00 00|
00050 > 00 00 00 00.00 00 00 00|00 AA 01 08.08 08 08 08|08 08 08 01.00 1A 0C 00|09 00 00 07.00 00 00 00|00 00 00 00.00 00 00 00|00 00 00 00.00 00 03 E3|00 00 01 D0.01 D0 01 D0|00 00 00 00.00 00 00 00|
00050 > 00 00 00 00.00 00 00 00|00 AA 01 08.08 08 08 08|08 08 08 01.00 1A 0C 00|09 00 00 07.00 00 00 00|00 00 00 00.00 00 00 00|00 00 00 00.00 00 03 E3|00 00 01 D0.01 D0 01 D0|00 00 00 00.00 00 00 00|
00050 > 00 00 00 00.00 00 00 00|00 AA 01 08.08 08 08 08|08 08 08 05.01 01 00 00|0A 00 00 07.05 00 00 00|00 00 00 00.00 05 00 00|00 00 00 00.00 00 03 45|00 00 00 00.09 C9 09 C9|00 00 00 00.00 00 00 00| Start to type 5 5
00050 > 00 00 00 00.00 00 00 00|00 AA 01 08.08 08 08 08|08 08 08 01.02 1A 0C 00|0A 00 00 07.05 00 00 00|00 00 00 00.00 05 05 00|00 00 00 00.00 00 04 07|00 00 01 C9.01 C9 01 C9|00 00 00 00.00 00 00 00|
00050 > 00 00 00 00.00 00 00 00|00 AA 01 08.08 08 08 08|08 08 08 04.02 15 09 04|0A 00 00 07.05 00 00 00|00 00 00 00.00 05 05 00|00 00 00 00.00 00 03 E3|00 00 02 74.01 C9 01 C9|00 00 00 00.00 00 00 00|
00050 > 00 00 00 00.00 00 00 00|00 00 FF FF.FF FF FF FF|FF FF FF 01.00 1A 0C 00|09 00 01 07.AA 05 05 00|00 00 00 00.00 00 00 00|00 00 00 00.00 00 03 E5|00 00 09 D0.09 D0 09 D0|00 00 00 00.00 00 00 00| Code refused
00050 > 00 00 00 00.00 00 00 00|00 00 FF FF.FF FF FF FF|FF FF FF 01.00 1A 0C 00|09 00 01 07.00 00 00 00|00 00 00 00.00 00 00 00|00 00 00 00.00 00 03 E5|00 00 09 D0.09 D0 09 D0|00 00 00 00.00 00 00 00|
00050 > 00 00 00 00.00 00 00 00|00 00 FF FF.FF FF FF FF|FF FF FF 01.00 1A 0C 00|09 00 01 07.00 00 00 00|00 00 00 00.00 00 00 00|00 00 00 00.00 00 03 E5|00 00 09 D0.09 D0 09 D0|00 00 00 00.00 00 00 00|
00050 > 00 00 00 00.00 00 00 00|00 00 FF FF.FF FF FF FF|FF FF FF 01.00 1A 0C 00|09 00 01 07.00 00 00 00|00 00 00 00.00 00 00 00|00 00 00 00.00 00 03 E5|00 00 09 D0.09 D0 09 D0|00 00 00 00.00 00 00 00|
00050 > 00 00 00 00.00 00 00 00|00 00 FF FF.FF FF FF FF|FF FF FF 01.00 1A 0C 00|08 00 01 07.00 00 00 00|00 00 00 00.00 00 00 00|00 00 00 00.00 00 03 E5|00 00 09 D0.09 D0 09 D0|00 00 00 00.00 00 00 00|
00050 > 00 00 00 00.00 00 00 00|00 00 FF FF.FF FF FF FF|FF FF FF 01.00 1A 0C 00|08 00 01 07.00 00 00 00|00 00 00 00.00 00 00 00|00 00 00 00.00 00 03 E5|00 00 09 D0.09 D0 09 D0|00 00 00 00.00 00 00 00|
00050 > 00 00 00 00.00 00 00 00|00 00 FF FF.FF FF FF FF|FF FF FF 01.00 1A 0C 00|08 00 01 07.00 00 00 00|00 00 00 00.00 00 00 00|00 00 00 00.00 00 03 E5|00 00 09 D0.09 D0 09 D0|00 00 00 00.00 00 00 00|

Flash start at     0x0000 4000
Last code ends at  0x0000 41FD
Code length: 10 bytes, 1st code is for programmer code
Byte syntax:
  1  00 if code disabled, AA if code active
  2  FF if code disabled, 01 for out 1 code, 02 for out 2 code, 03 for programmer code (first code only)
  3..10  FF if disabled, 01 for 1, 02 for 2, .. 10 for 0, 00 for all the bytes (keys) not in use

  *
  */
